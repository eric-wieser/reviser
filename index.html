<html>
<body>
  <div id="document-wrapper"></div>
  <canvas id="main-document"></canvas>
  <canvas id="question"></canvas>

  <!-- Use latest PDF.js build from Github -->
  <script type="text/javascript" src="https://rawgithub.com/mozilla/pdf.js/gh-pages/build/pdf.js"></script>
  <script type="text/javascript" src="sugar.min.js"></script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-git2.js"></script>

  <style>
  body {
    margin: 0;
    padding: 0;
  }
  #document-wrapper {
    height: 100vh;
    background: gray;
    overflow: scroll;
  }
  #document-wrapper canvas {
    margin: 10px;
    box-shadow: 0 0 5px black;
    border: 1px solid #808080;
    display: block;
  }
  </style>

  <script type="text/javascript">
    //
    // NOTE:
    // Modifying the URL below to another server will likely *NOT* work. Because of browser
    // security restrictions, we have to use a file server with special headers
    // (CORS) - most servers don't support cross-origin browser requests.
    //
    var url = 'P1A2004Q004.pdf';

    //
    // Disable workers to avoid yet another cross-origin issue (workers need the URL of
    // the script to be loaded, and dynamically loading a cross-origin script does
    // not work)
    //
    PDFJS.disableWorker = true;

    var canvas = document.getElementById('main-document');
    var context = canvas.getContext('2d');

    //
    // Asynchronous download PDF as an ArrayBuffer
    //
    PDFJS.getDocument(url).then(function getPdf(pdf) {

      var dr = $('#document-wrapper');
      Number.range(1, pdf.numPages).every().map(function(i) {
        var c = $('<canvas>').appendTo(dr);

        var canvas = c[0];
        var context = canvas.getContext('2d');

        return pdf.getPage(i).then(function getPage(page) {
          var fullVP = page.getViewport(1);

          var newVP = new PDFJS.PageViewport(
            /* viewBox  */ [
              fullVP.viewBox[0],
              fullVP.viewBox[3] / 2,
              fullVP.viewBox[2],
              fullVP.viewBox[3]
            ],
            /* scale    */ 1,
            /* rotation */ 0,
            /* offset   */ 0, 0
          )

          //
          // Prepare canvas using PDF page dimensions
          //
          canvas.height = newVP.height;
          canvas.width = newVP.width;

          //
          // Render PDF page into canvas context
          //
          return page.render({canvasContext: context, viewport: newVP});
        });
      });
    });
  </script>
</body>
</html>
